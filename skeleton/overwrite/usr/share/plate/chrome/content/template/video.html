<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<script type="text/javascript" src="../jquery-1.3.2.js"></script>
<script type="text/javascript" src="../plate.js"></script>
<script type="text/javascript">

function set_video() {
	var output = document.getElementById('output').name;
	var mode = document.getElementById('output').value;
	system('/usr/bin/xrandr --output ' + output + ' --mode ' + mode);
}
function update_div_ife(id, path) {
	netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"); 
	var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
	file.initWithPath(path);
	// check if file exists
	var i=30; // timeout for 15s
	while ( file.exists() == false && i>0)
	{
		sleep(500);
		i--;
	}
	
	var data = "";
	var fstream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
	var sstream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
	fstream.init(file, -1, 0, 0);
	sstream.init(fstream); 

	var str = sstream.read(4096);
	while (str.length > 0) {
		data += str;
		str = sstream.read(4096);
	}

	sstream.close();
	fstream.close();

	document.getElementById(id).innerHTML = data;
	// remove video.opt file after reading FIXME, if there's a better way
	system('rm /tmp/video.opt');
}
</script>
</head>
<body onload="system('/usr/local/bin/get_video'); update_div_ife('video-option', '/tmp/video.opt');">

<div style="margin: 20px auto; width: 400px;">
<h2 style="border-bottom: 1px gray solid;">Video settings</h2>

<p>Choose screen resolution:</p>

<div id="video-option"></div>

</div>

</body>
</html>
